<!DOCTYPE html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  
    
  <title>Go 1.11 新特性：Go Modules | RoninRo&#39;s Blog</title>
  <meta name="author" content="RoninRo">
  <meta name="description" content="Go 1.11 为 modules 带来了实验性支持，这是Go的一个新的依赖管理系统。">
  <meta name="keywords" content="blog,developer,personal,golang">

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go 1.11 新特性：Go Modules"/>
<meta name="twitter:description" content="Go 1.11 为 modules 带来了实验性支持，这是Go的一个新的依赖管理系统。"/>

  <meta property="og:title" content="Go 1.11 新特性：Go Modules" />
<meta property="og:description" content="Go 1.11 为 modules 带来了实验性支持，这是Go的一个新的依赖管理系统。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://roninro.github.io/posts/2018/go-moudle/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-09-09T19:49:47+08:00" />
<meta property="article:modified_time" content="2018-09-09T19:49:47+08:00" />


  <link rel="stylesheet" href="/css/bootstrap.min.css"  crossorigin="anonymous">
  
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.1/css/all.min.css" rel="stylesheet" type="text/css">

  <link rel="stylesheet" href="/sass/main.css">

  <link rel="stylesheet" href="/zoomjs/zoom.min.css">

  <script src=/js/lazysizes.min.js></script>

  
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <link rel="shortcut icon" href="/favicon.png" type="image/x-icon">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/logo.svg" sizes="any" type="image/svg+xml" />


</head>



<body ontouchstart="">
  <nav class="navbar navbar-default navbar-custom navbar-fixed-top invert">
  <div class="container-fluid">
    
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://roninro.github.io/">RoninRo&#39;s Blog</a>
    </div>
    
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          
          <li><a href="/" title="Home">Home</a></li>
          
          <li><a href="/archive/" title="Archive">Archive</a></li>
          
          <li><a href="/categories/" title="Categories">Categories</a></li>
          
          <li><a href="/about/" title="About">About</a></li>
          

          <li class="search-icon">
            <a href="javascript:void(0)">
              <i class="fa fa-search"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
    
  </div>
  
</nav>
<script>
  
  
  
  var $body = document.body;
  var $toggle = document.querySelector(".navbar-toggle");
  var $navbar = document.querySelector("#huxblog_navbar");
  var $collapse = document.querySelector(".navbar-collapse");

  var __HuxNav__ = {
    close: function () {
      $navbar.className = " ";
      
      setTimeout(function () {
        
        if ($navbar.className.indexOf("in") < 0) {
          $collapse.style.height = "0px";
        }
      }, 400);
    },
    open: function () {
      $collapse.style.height = "auto";
      $navbar.className += " in";
    },
  };

  
  $toggle.addEventListener("click", function (e) {
    if ($navbar.className.indexOf("in") > 0) {
      __HuxNav__.close();
    } else {
      __HuxNav__.open();
    }
  });

  

  document.addEventListener("click", function (e) {
    if (e.target == $toggle) return;
    if (e.target.className == "icon-bar") return;
    __HuxNav__.close();
  });
</script>
  
<div class="search-page">
  <div class="search-icon-close-container">
    <span class="search-icon-close">
      <i class="fa fa-chevron-down"></i>
    </span>
  </div>
  <div class="search-main container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <form></form>
        <input type="text" id="search-input" placeholder="$ grep...">
        </form>
        <div id="search-results" class="mini-post-list"></div>
      </div>
    </div>
  </div>
</div>

  
  


<style type="text/css">
  header.intro-header {
    position: relative;
    background-image: url('');
  }
</style>

<header class="intro-header style-text">

  <div class="header-mask"></div>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <div class="tags">
            
            <a class="tag" href="/tags/golang/" title="golang">golang</a>
            
          </div>
          <h1>Go 1.11 新特性：Go Modules</h1>
          <h2 class="subheading"></h2>
          <span class="meta">
            Posted by  RoninRo 
            on Sun, Sep 9, 2018
          </span>
        </div>
      </div>
    </div>
  </div>
</header>


  


<article>
  <div class="container">
    <div class="row">

      
      <div class="
              col-lg-8 col-lg-offset-2
              col-md-10 col-md-offset-1
              post-container">
        <p>Go 1.11 为 <em>modules</em> 带来了实验性支持，这是Go的一个新的依赖管理系统。</p>
<h2 id="1-modules">1. Modules<a class="anchorjs-link" href="#1-modules"></a></h2><blockquote>
<p>示例来自 <a href="https://roberto.selbach.ca/intro-to-go-modules/" target="_blank">Introduction to Go Modules</a></p>
</blockquote>
<p><code>go module</code> 支持在 <code>$GOPATH</code> 之外建立 <code>package</code>。并且在 <code>$GOPATH</code> 中是默认禁止的。</p>
<blockquote>
<p>在 <code>$GOPATH</code> 使用 <code>go module</code>,要设置 <code>GO111MODULE=on</code>，如果没设置，执行命令的时候会有提示。</p>
</blockquote>
<h2 id="gomod">go.mod<a class="anchorjs-link" href="#gomod"></a></h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-v" data-lang="v"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#8be9fd;font-style:italic">download</span>    <span style="color:#8be9fd;font-style:italic">download</span> <span style="color:#8be9fd;font-style:italic">modules</span> <span style="color:#8be9fd;font-style:italic">to</span> <span style="color:#8be9fd;font-style:italic">local</span> <span style="color:#8be9fd;font-style:italic">cache</span> (<span style="color:#8be9fd;font-style:italic">下载依赖的module到本地cache</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span><span style="color:#8be9fd;font-style:italic">edit</span>        <span style="color:#8be9fd;font-style:italic">edit</span> <span style="color:#ff79c6">go</span>.<span style="color:#8be9fd;font-style:italic">mod</span> <span style="color:#8be9fd;font-style:italic">from</span> <span style="color:#8be9fd;font-style:italic">tools</span> <span style="color:#ff79c6">or</span> <span style="color:#8be9fd;font-style:italic">scripts</span> (<span style="color:#8be9fd;font-style:italic">编辑go</span>.<span style="color:#8be9fd;font-style:italic">mod文件</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#8be9fd;font-style:italic">graph</span>       <span style="color:#8be9fd;font-style:italic">print</span> <span style="color:#ff79c6">module</span> <span style="color:#8be9fd;font-style:italic">requirement</span> <span style="color:#8be9fd;font-style:italic">graph</span> (<span style="color:#8be9fd;font-style:italic">打印模块依赖图</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span><span style="color:#8be9fd;font-style:italic">init</span>        <span style="color:#8be9fd;font-style:italic">initialize</span> <span style="color:#8be9fd;font-style:italic">new</span> <span style="color:#ff79c6">module</span> <span style="color:#ff79c6">in</span> <span style="color:#8be9fd;font-style:italic">current</span> <span style="color:#8be9fd;font-style:italic">directory</span> (<span style="color:#8be9fd;font-style:italic">再当前文件夹下初始化一个新的module</span>, <span style="color:#8be9fd;font-style:italic">创建go</span>.<span style="color:#8be9fd;font-style:italic">mod文件</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span><span style="color:#8be9fd;font-style:italic">tidy</span>        <span style="color:#8be9fd;font-style:italic">add</span> <span style="color:#8be9fd;font-style:italic">missing</span> <span style="color:#8be9fd;font-style:italic">and</span> <span style="color:#8be9fd;font-style:italic">remove</span> <span style="color:#8be9fd;font-style:italic">unused</span> <span style="color:#8be9fd;font-style:italic">modules</span> (<span style="color:#8be9fd;font-style:italic">增加丢失的module</span>，<span style="color:#8be9fd;font-style:italic">去掉未用的module</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span><span style="color:#8be9fd;font-style:italic">vendor</span>      <span style="color:#8be9fd;font-style:italic">make</span> <span style="color:#8be9fd;font-style:italic">vendored</span> <span style="color:#8be9fd;font-style:italic">copy</span> <span style="color:#8be9fd;font-style:italic">of</span> <span style="color:#8be9fd;font-style:italic">dependencies</span> (<span style="color:#8be9fd;font-style:italic">将依赖复制到vendor下</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span><span style="color:#8be9fd;font-style:italic">verify</span>      <span style="color:#8be9fd;font-style:italic">verify</span> <span style="color:#8be9fd;font-style:italic">dependencies</span> <span style="color:#8be9fd;font-style:italic">have</span> <span style="color:#8be9fd;font-style:italic">expected</span> <span style="color:#8be9fd;font-style:italic">content</span> (<span style="color:#8be9fd;font-style:italic">校验依赖</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span><span style="color:#8be9fd;font-style:italic">why</span>         <span style="color:#8be9fd;font-style:italic">explain</span> <span style="color:#8be9fd;font-style:italic">why</span> <span style="color:#8be9fd;font-style:italic">packages</span> <span style="color:#ff79c6">or</span> <span style="color:#8be9fd;font-style:italic">modules</span> <span style="color:#8be9fd;font-style:italic">are</span> <span style="color:#8be9fd;font-style:italic">needed</span> (<span style="color:#8be9fd;font-style:italic">解释为什么需要依赖</span>)
</span></span></code></pre></div><h2 id="创建一个module">创建一个Module<a class="anchorjs-link" href="#%e5%88%9b%e5%bb%ba%e4%b8%80%e4%b8%aamodule"></a></h2><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>$ mkdir testmod
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>$ <span style="color:#8be9fd;font-style:italic">cd</span> testmod
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>$ go mod init github.com/robteix/testmod
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>go: creating new go.mod: module github.com/robteix/testmod
</span></span></code></pre></div><p>创建一个简单的package 文件，</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span><span style="color:#ff79c6">package</span> testmod
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#ff79c6">import</span> <span style="color:#f1fa8c">&#34;fmt&#34;</span> 
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span><span style="color:#6272a4">// Hi returns a friendly greeting
</span></span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span><span style="color:#6272a4"></span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">Hi</span>(name <span style="color:#8be9fd">string</span>) <span style="color:#8be9fd">string</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7</span><span>   <span style="color:#ff79c6">return</span> fmt.<span style="color:#50fa7b">Sprintf</span>(<span style="color:#f1fa8c">&#34;Hi, %s&#34;</span>, name)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8</span><span>}
</span></span></code></pre></div><p>让我们看看 <code>go.mod</code> 中的内容：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span> cat go.mod
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>module github.com/mjyi/testmod
</span></span></code></pre></div><p>下面就可以把代码提交到github上面使用了。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>$ git init 
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>$ git add * 
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>$ git commit -am <span style="color:#f1fa8c">&#34;First commit&#34;</span> 
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>$ git push -u origin master
</span></span></code></pre></div><p>现在，我们可以通过 <code>go get</code> 在任何地方使用它：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>$ go get github.com/robteix/testmod
</span></span></code></pre></div><p>这样将获取 <code>master</code> 上的最新代码，但是，本质上，获取 <code>master</code> 使用是非常危险的，因为我们不知道包的作者作出了什么改变可能影响我们的使用。这也是 <code>modules</code> 旨在解决的问题。</p>
<h2 id="module-版本">Module 版本<a class="anchorjs-link" href="#module-%e7%89%88%e6%9c%ac"></a></h2><p>一个 <code>module</code> 必须以 <code>v(major).(minor).(patch)</code> 的形式进行语义版本化，例如v0.1.0，v1.2.3或v3.0.1。 <code>v</code> 是必需的。如果使用Git，发布 <a href="https://git-scm.com/book/en/v2/Git-Basics-Tagging" target="_blank">tag</a> 提交版本。</p>
<p>关于语义化版本参考：<a href="https://semver.org/lang/zh-CN/" target="_blank">语义化版本 2.0</a></p>
<h3 id="发布一个-release-版本">发布一个 release 版本<a class="anchorjs-link" href="#%e5%8f%91%e5%b8%83%e4%b8%80%e4%b8%aa-release-%e7%89%88%e6%9c%ac"></a></h3><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>git tag v1.0.0
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>git push --tags
</span></span></code></pre></div><p>这样就创建了在 Github 上面创建了一个tag，release 1.0.0。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>git checkout -b v1
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>git push -u origin v1
</span></span></code></pre></div><p><em>创建一个新的分支（v1），方便我们推送 bug 修复。</em>
现在在 <code>master</code> 上发布修改就不用担心会破坏我们的发布版本。</p>
<h3 id="发布一个-bugfix-release">发布一个 bugfix release<a class="anchorjs-link" href="#%e5%8f%91%e5%b8%83%e4%b8%80%e4%b8%aa-bugfix-release"></a></h3><p>发布了一个版本之后，如果发现了一些小的bug，那么我们需要发布一个新版本来修复它们。
我们在 v1 分支中修改这些，因为它与之后为 v2 做的事情无关，但在实际上，你也许会在 <code>master</code> 中进行修改，然后再向后移植。无论哪种方式，我们都需要在 v1 分支中进行修复并将其标记为新版本。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>git commit -m <span style="color:#f1fa8c">&#34;Emphasize our friendliness&#34;</span> testmod.go
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>git tag v1.0.1
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span>git push --tags origin v1
</span></span></code></pre></div><h2 id="更新-modules">更新 modules<a class="anchorjs-link" href="#%e6%9b%b4%e6%96%b0-modules"></a></h2><ul>
<li><code>go get -u</code> 更新到最新的 <code>minor</code> 或者 <code>patch</code> realease (i.e. 从 1.0.0 更新到 1.0.1，如果有 1.1.0， 则更新到 1.1.0)</li>
<li><code>go get -u=patch</code> 更新到最新的 <code>patch</code> release (i.e. 从 1.0.0 更新到 1.0.1, 不会更新1.1.0)</li>
<li><code>go get package@version</code> 更新到指定版本 (i.e. <code>github.com/robteix/testmod@v1.0.1</code>)</li>
</ul>
<h2 id="major-versions">Major versions<a class="anchorjs-link" href="#major-versions"></a></h2><p>根据语义版本语义，<code>major</code> 版本与 <code>minors</code> 不同。<code>major</code> 版本可以破坏向后兼容性。
从 Go modules 的角度来看，<code>major</code> 版本是一个完全不同的包。这听起来可能很奇怪，但它是有道理的：一个库的两个彼此不兼容的版本是两个不同的库。</p>
<p>我们来提交一个新版本 <code>v2</code>，将新版本路径附加到模块名称的末尾来完成此操作。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>module github.com<span style="color:#ff79c6">/</span>robteix<span style="color:#ff79c6">/</span>testmod<span style="color:#ff79c6">/</span>v2
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1</span><span>git commit testmod.go -m <span style="color:#f1fa8c">&#34;Change Hi to allow multilang&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2</span><span>git checkout -b v2 <span style="color:#6272a4"># optional but recommended</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3</span><span><span style="color:#8be9fd;font-style:italic">echo</span> <span style="color:#f1fa8c">&#34;module github.com/robteix/testmod/v2&#34;</span> &gt; go.mod
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4</span><span>git commit go.mod -m <span style="color:#f1fa8c">&#34;Bump version to v2&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5</span><span>git tag v2.0.0
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6</span><span>git push --tags origin v2 <span style="color:#6272a4"># or master if we don&#39;t have a branch</span>
</span></span></code></pre></div><h2 id="更新到新的-major-版本">更新到新的 major 版本<a class="anchorjs-link" href="#%e6%9b%b4%e6%96%b0%e5%88%b0%e6%96%b0%e7%9a%84-major-%e7%89%88%e6%9c%ac"></a></h2><p>即使我们发布了一个新的不兼容版本的库，现有的软件也不会被破坏，因为它将继续使用现有的1.0.1版本。 <code>go get -u</code> 将无法获得2.0.0版本。</p>
<p>我们可以这样使用 v2 版本：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#ff79c6">package</span> main
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span><span style="color:#ff79c6">import</span> (
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    <span style="color:#f1fa8c">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    <span style="color:#f1fa8c">&#34;github.com/robteix/testmod/v2&#34;</span> 
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>    g, err <span style="color:#ff79c6">:=</span> testmod.<span style="color:#50fa7b">Hi</span>(<span style="color:#f1fa8c">&#34;Roberto&#34;</span>, <span style="color:#f1fa8c">&#34;pt&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>        <span style="color:#8be9fd;font-style:italic">panic</span>(err)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    fmt.<span style="color:#50fa7b">Println</span>(g)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>}
</span></span></code></pre></div><p>正如之前据说，v2版本是一个完全不同的包。 所以我们可以在同一个二进制文件中使用两个不兼容的库：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1</span><span><span style="color:#ff79c6">package</span> main
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2</span><span><span style="color:#ff79c6">import</span> (
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3</span><span>    <span style="color:#f1fa8c">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4</span><span>    <span style="color:#f1fa8c">&#34;github.com/robteix/testmod&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5</span><span>    testmodML <span style="color:#f1fa8c">&#34;github.com/robteix/testmod/v2&#34;</span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6</span><span>)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7</span><span>
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8</span><span><span style="color:#8be9fd;font-style:italic">func</span> <span style="color:#50fa7b">main</span>() {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9</span><span>    fmt.<span style="color:#50fa7b">Println</span>(testmod.<span style="color:#50fa7b">Hi</span>(<span style="color:#f1fa8c">&#34;Roberto&#34;</span>))
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10</span><span>    g, err <span style="color:#ff79c6">:=</span> testmodML.<span style="color:#50fa7b">Hi</span>(<span style="color:#f1fa8c">&#34;Roberto&#34;</span>, <span style="color:#f1fa8c">&#34;pt&#34;</span>)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11</span><span>    <span style="color:#ff79c6">if</span> err <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">nil</span> {
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12</span><span>        <span style="color:#8be9fd;font-style:italic">panic</span>(err)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13</span><span>    }
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14</span><span>    fmt.<span style="color:#50fa7b">Println</span>(g)
</span></span><span style="display:flex;"><span style="white-space:pre;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15</span><span>}
</span></span></code></pre></div><h2 id="vendoring">Vendoring<a class="anchorjs-link" href="#vendoring"></a></h2><p><code>Go modules</code> 默认会忽略 <code>vendor/</code> 目录。</p>
<p><code>go mod vendor</code> 会在项目根目录创建一个 <code>vendor/</code> 目录，其包含项目的所有依赖项。</p>
<h2 id="参考">参考<a class="anchorjs-link" href="#%e5%8f%82%e8%80%83"></a></h2><p><a href="https://github.com/golang/go/wiki/Modules" target="_blank">Go Modules</a>
<a href="https://roberto.selbach.ca/intro-to-go-modules/" target="_blank">Introduction to Go Modules</a></p>

        <hr style="visibility: hidden;" />
        <ul class="pager">
          
          <li class="previous">
            <a href="/posts/2018/gcd-swift/" data-toggle="tooltip" data-placement="top" title="Swift 中的GCD ">
              Previous<br>
              <span>Swift 中的GCD </span>
            </a>
          </li>
          
          
          <li class="next">
            <a href="/posts/2019/ios-document-picker/" data-toggle="tooltip" data-placement="top" title="访问 iCloud 云盘文件">
              Next<br>
              <span>访问 iCloud 云盘文件</span>
            </a>
          </li>
          
        </ul>
        <hr style="visibility: hidden;" />

        
        



<div class="giscus" id="comments"></div>
<script src="https://giscus.app/client.js" 
  data-repo="roninro/blog" 
  data-repo-id="MDEwOlJlcG9zaXRvcnkzMDkyNTUzODI="
  data-category="Comments"
  data-category-id="DIC_kwDOEm7c1s4B_sst"
  data-mapping="pathname"
  data-strict="0" 
  data-reactions-enabled="1" 
  data-emit-metadata="0" 
  data-input-position="top"
  data-theme="light"
  data-lang="en"
  crossorigin="anonymous"
  async>
  </script>




      </div>

      
      
      
      
      <div class="
              col-lg-8 col-lg-offset-2
              col-md-10 col-md-offset-1
              sidebar-container">

        
        
        <section>
  
  
  <hr class="hidden-sm hidden-xs">
  
  <h5>FEATURED TAGS</h5>
  <div class="tags">
    
    <a href="/tags/css/">css</a>
    
    <a href="/tags/debian/">debian</a>
    
    <a href="/tags/fzf/">fzf</a>
    
    <a href="/tags/gcd/">gcd</a>
    
    <a href="/tags/gem/">gem</a>
    
    <a href="/tags/git/">git</a>
    
    <a href="/tags/golang/">golang</a>
    
    <a href="/tags/hugo/">hugo</a>
    
    <a href="/tags/ios/">iOS</a>
    
    <a href="/tags/kindle/">Kindle</a>
    
    <a href="/tags/linux/">linux</a>
    
    <a href="/tags/macos/">MacOS</a>
    
    <a href="/tags/neovim/">neovim</a>
    
    <a href="/tags/runtime/">runtime</a>
    
    <a href="/tags/rust/">rust</a>
    
    <a href="/tags/ss/">ss</a>
    
    <a href="/tags/ssh/">ssh</a>
    
    <a href="/tags/swift/">Swift</a>
    
    <a href="/tags/vim/">vim</a>
    
    <a href="/tags/wubi/">wubi</a>
    
    <a href="/tags/zabbix/">zabbix</a>
    
  </div>
</section>

        
        

<hr>
<h5>FRIENDS</h5>
<ul class="list-inline">
  
  <li><a href="" target="_blank"></a></li>
  
</ul>

      </div>
    </div>
  </div>
</article>



  
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        
        <ul class="list-inline text-center">

<li>
  <a href="https://github.com/roninro" target="_blank">
    <span class="fa-stack fa-lg">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fab fa-github fa-stack-1x fa-inverse"></i>
    </span>
  </a>
</li>


<li>
  <a href="/index.xml" target="_blank">
    <span class="fa-stack fa-lg">
      <i class="fa fa-circle fa-stack-2x"></i>
      <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
    </span>
  </a>
</li></ul>

        <p class="copyright text-muted">
          Copyright &copy; RoninRo&#39;s Blog 2023  
          <br>
          Powered by <a href="https://gohugo.io">Hugo</a>
        </p>
      </div>
    </div>
  </div>
</footer>

<script src=/js/jquery.min.js></script>
<script src=/js/bootstrap.min.js crossorigin="anonymous"></script>



<script src="/js/hux-blog.min.c4ea77041cd3edbfc8b2622cd887a9a5d8760a4162d14489e36d2a3fa4c90172.js"></script>


<script src=/js/simple-jekyll-search.min.js></script>


<script src="/js/search.min.53bce5da475b4d362500e5ce5dddfa22e20e1b9018777411d2020b4b839c9310.js"></script>













<script src="/zoomjs/zoom.min.js"></script>

</body>

</html>